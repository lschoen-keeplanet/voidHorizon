import ServerDocumentMixin from"../backend/server-document.mjs";import{BaseJournalEntryPage}from"../../../common/documents/module.mjs";import showdown from"showdown";import{cleanHTML}from"../validators.mjs";export default class JournalEntryPage extends(ServerDocumentMixin(BaseJournalEntryPage)){static#e=(()=>(Object.entries(CONST.SHOWDOWN_OPTIONS).forEach((([e,t])=>showdown.setOption(e,t))),new showdown.Converter))();async _preCreate(e,t,r){await super._preCreate(e,t,r),this.#t(this.text?.markdown)}async _preUpdate(e,t,r){await super._preUpdate(e,t,r),this.#t(e.text?.markdown,e)}#t(e,t){const r=this.text.format===CONST.JOURNAL_ENTRY_PAGE_FORMATS.MARKDOWN&&e;if("text"!==this.type||!r)return;let o=JournalEntryPage.#e.makeHtml(e);o=cleanHTML(o),t&&(t["text.content"]=o),this.updateSource({"text.content":o})}}