<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Correction de l'affichage du Malus d'Agilit√©</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        code { background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
        .section { margin: 20px 0; padding: 15px; border-left: 4px solid #007cba; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>üéØ Test - Correction de l'affichage du Malus d'Agilit√©</h1>
    
    <div class="section">
        <h2>‚úÖ Probl√®me r√©solu</h2>
        <p>Le malus d'agilit√© d√ª √† l'armure n'apparaissait pas sous la caract√©ristique Agilit√© sur la fiche personnage.</p>
    </div>

    <div class="section">
        <h2>üîç Causes identifi√©es</h2>
        <ol>
            <li><strong>Condition HTML incorrecte :</strong> La condition v√©rifiait si le malus √©tait > 0, mais les malus sont des nombres n√©gatifs (-4, -8, -16)</li>
            <li><strong>Acc√®s direct √† la variable :</strong> Le template acc√©dait directement √† <code>actor.system.armorAgilityPenalty.value</code> au lieu d'utiliser le helper <code>getAgilityPenalty</code></li>
            <li><strong>Pas de mise √† jour en temps r√©el :</strong> L'affichage n'√©tait pas mis √† jour quand le type d'armure changeait</li>
        </ol>
    </div>

    <div class="section">
        <h2>üõ†Ô∏è Corrections apport√©es</h2>
        
        <h3>1. Correction du template HTML</h3>
        <p><strong>Avant :</strong></p>
        <code>
            {{#if (gt actor.system.armorAgilityPenalty.value 0)}}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Malus d'armure: {{actor.system.armorAgilityPenalty.value}}<br>
            {{else}}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Aucun malus d'armure<br>
            {{/if}}
        </code>
        
        <p><strong>Apr√®s :</strong></p>
        <code>
            {{#if (lt (helpers.getAgilityPenalty actor) 0)}}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Malus d'armure: {{helpers.getAgilityPenalty actor}}<br>
            {{else}}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Aucun malus d'armure<br>
            {{/if}}
        </code>

        <h3>2. Ajout de la m√©thode <code>_updateAgilityPenaltyDisplay()</code></h3>
        <p>Nouvelle m√©thode qui met √† jour l'affichage du malus d'agilit√© en temps r√©el :</p>
        <ul>
            <li>Recalcule le malus bas√© sur le type d'armure actuel</li>
            <li>Met √† jour l'affichage HTML directement</li>
            <li>G√®re les cas avec et sans malus</li>
        </ul>

        <h3>3. Int√©gration dans les √©v√©nements</h3>
        <ul>
            <li><strong>Changement d'armure :</strong> Appel automatique lors du changement de type d'armure</li>
            <li><strong>Initialisation :</strong> Appel lors du chargement initial de la fiche</li>
            <li><strong>D√©lai de 0.5s :</strong> Appel apr√®s le d√©lai pour s'assurer que tout est charg√©</li>
        </ul>
    </div>

    <div class="section">
        <h2>üß™ Tests √† effectuer</h2>
        <ol>
            <li><strong>Affichage initial :</strong> V√©rifier que le malus s'affiche correctement au chargement de la fiche</li>
            <li><strong>Changement d'armure :</strong> Changer le type d'armure et v√©rifier que le malus se met √† jour imm√©diatement</li>
            <li><strong>Types d'armure :</strong> Tester tous les types :
                <ul>
                    <li><strong>Tissu :</strong> Aucun malus (ic√¥ne verte)</li>
                    <li><strong>L√©g√®re :</strong> Malus de -4 (ic√¥ne orange)</li>
                    <li><strong>Lourde :</strong> Malus de -8 (ic√¥ne orange)</li>
                    <li><strong>Blind√©e :</strong> Malus de -16 (ic√¥ne orange)</li>
                </ul>
            </li>
            <li><strong>Jets d'agilit√© :</strong> V√©rifier que le malus est appliqu√© aux jets d'agilit√© et affich√© dans le chat</li>
        </ol>
    </div>

    <div class="section">
        <h2>üìÅ Fichiers modifi√©s</h2>
        <ul>
            <li><strong><code>templates/sheets/heros-sheet.html</code></strong> : Correction de la condition et utilisation du helper</li>
            <li><strong><code>scripts/heros-sheet.js</code></strong> : Ajout de <code>_updateAgilityPenaltyDisplay()</code> et int√©gration dans les √©v√©nements</li>
        </ul>
    </div>

    <div class="section">
        <h2>üéâ R√©sultat attendu</h2>
        <p>Le malus d'agilit√© d√ª √† l'armure doit maintenant s'afficher correctement sous la caract√©ristique Agilit√© et se mettre √† jour en temps r√©el lors des changements d'armure.</p>
    </div>

    <script>
        console.log("Test de correction du malus d'agilit√© - VoidHorizon");
    </script>
</body>
</html>
