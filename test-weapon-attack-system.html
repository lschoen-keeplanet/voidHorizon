<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Système d'Attaque d'Armes avec Modes Safe/Unsafe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .success { color: #4CAF50; font-weight: bold; }
        .warning { color: #FF9800; font-weight: bold; }
        .error { color: #F44336; font-weight: bold; }
        .info { color: #2196F3; font-weight: bold; }
        code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .feature {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
        }
        .critical {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>🎯 Test - Système d'Attaque d'Armes avec Modes Safe/Unsafe</h1>
    
    <div class="feature">
        <h2>✅ Fonctionnalités Implémentées</h2>
        <ul>
            <li><strong>Deux modes d'attaque :</strong> Safe et Unsafe</li>
            <li><strong>Formule d'attaque :</strong> jet de compétence + jet de qualité + bonus</li>
            <li><strong>Détection des coups critiques :</strong> Succès et échecs critiques pour le mode Unsafe</li>
            <li><strong>Interface utilisateur :</strong> Boutons distincts avec couleurs différentes</li>
            <li><strong>Gestion des boucliers :</strong> Boutons automatiquement cachés</li>
        </ul>
    </div>

    <div class="feature">
        <h2>🎲 Formules d'Attaque</h2>
        <h3>Mode Safe :</h3>
        <p><code>jet de compétence (safe) + bonus traits + malus agilité + jet de qualité + bonus arme</code></p>
        
        <h3>Mode Unsafe :</h3>
        <p><code>jet de compétence (unsafe) + bonus traits + malus agilité + jet de qualité + bonus arme</code></p>
        
        <p><strong>Note :</strong> Le mode Unsafe transforme automatiquement les dés de caractéristique selon la règle standard : 4d4 devient 1d20, 3d4 devient 1d16, etc. Les coups critiques se basent sur ces dés transformés.</p>
        <p><strong>Important :</strong> Les bonus de traits et malus d'agilité (armure) sont maintenant automatiquement appliqués aux jets d'attaque d'armes !</p>
    </div>

    <div class="critical">
        <h2>⭐ Système de Coups Critiques (Mode Unsafe uniquement)</h2>
        <h3>Réussite Critique :</h3>
        <p>Quand le résultat des dés de caractéristique <strong>transformed</strong> est égal au <strong>maximum possible</strong> de la formule unsafe.</p>
        <p><strong>Exemple :</strong> Pour 4d4 → 1d20 (max 20), si le résultat des 1d20 est 20 → ⭐ RÉUSSITE CRITIQUE!</p>
        
        <h3>Échec Critique :</h3>
        <p>Quand le résultat des dés de caractéristique <strong>transformed</strong> est égal au <strong>minimum possible</strong> de la formule unsafe.</p>
        <p><strong>Exemple :</strong> Pour 4d4 → 1d20 (min 1), si le résultat des 1d20 est 1 → 💥 ÉCHEC CRITIQUE!</p>
        
        <p><strong>Important :</strong> Les coups critiques se basent sur les dés de caractéristique transformés (unsafe), pas sur les dés de base ou les dés de qualité.</p>
    </div>

    <div class="feature">
        <h2>🔧 Types d'Armes et Caractéristiques</h2>
        <ul>
            <li><strong>Force (strength) →</strong> Martialité</li>
            <li><strong>Agilité (agility) →</strong> Agilité</li>
            <li><strong>Acuité (acuite) →</strong> Acuité</li>
            <li><strong>Bouclier (shield) →</strong> Pas de bouton d'attaque</li>
        </ul>
    </div>

    <div class="feature">
        <h2>🔄 Transformation des Dés (Mode Unsafe)</h2>
        <p>En mode Unsafe, les dés de caractéristique sont automatiquement transformés :</p>
        <ul>
            <li><strong>2d4 → 1d12</strong> (Degré 1)</li>
            <li><strong>3d4 → 1d16</strong> (Degré 2)</li>
            <li><strong>4d4 → 1d20</strong> (Degré 3)</li>
            <li><strong>5d4 → 1d24</strong> (Degré 4)</li>
            <li><strong>6d4 → 1d28</strong> (Degré 5)</li>
            <li><strong>7d4 → 1d32</strong> (Degré 6)</li>
        </ul>
        <p><strong>Note :</strong> Cette transformation suit la même règle que les jets de caractéristique unsafe.</p>
    </div>

    <div class="feature">
        <h2>🎯 Bonus et Malus Intégrés</h2>
        <p>Les jets d'attaque d'armes prennent maintenant automatiquement en compte :</p>
        <ul>
            <li><strong>Bonus de traits :</strong> Appliqués à la caractéristique correspondante</li>
            <li><strong>Malus d'agilité :</strong> Dû au type d'armure équipée</li>
            <li><strong>Bonus d'arme :</strong> Bonus intrinsèque de l'équipement</li>
        </ul>
        <p><strong>Exemple :</strong> Une arme de type "Agilité" avec un personnage ayant +2 bonus trait et -1 malus d'armure lourde appliquera automatiquement ces modificateurs.</p>
    </div>

    <div class="feature">
        <h2>⚔️ Qualité des Armes</h2>
        <ul>
            <li><strong>Rang 0 :</strong> Équipement brisé → 1d4</li>
            <li><strong>Rang 1 :</strong> Équipement commun → 1d6</li>
            <li><strong>Rang 2 :</strong> Équipement de qualité → 1d8</li>
            <li><strong>Rang 3 :</strong> Équipement rare → 1d10</li>
            <li><strong>Rang 4 :</strong> Équipement exceptionnel → 1d12</li>
            <li><strong>Rang 5 :</strong> Équipement légendaire → 1d20</li>
        </ul>
    </div>

    <div class="feature">
        <h2>🎨 Interface Utilisateur</h2>
        <h3>Boutons d'Attaque :</h3>
        <ul>
            <li><strong>Bouton Safe :</strong> 🟢 Vert avec icône bouclier</li>
            <li><strong>Bouton Unsafe :</strong> 🔴 Rouge avec icône épée</li>
            <li><strong>Disposition :</strong> Côte à côte avec espacement égal</li>
            <li><strong>Masquage automatique :</strong> Pour les boucliers</li>
        </ul>
    </div>

    <div class="feature">
        <h2>📝 Messages de Chat</h2>
        <p>Chaque attaque génère un message détaillé dans le chat contenant :</p>
        <ul>
            <li>🎯 Titre de l'attaque avec nom de l'arme</li>
            <li>⭐/💥 Message de coup critique (si applicable)</li>
            <li>Mode d'attaque (Safe/Unsafe)</li>
            <li>Caractéristique et dés utilisés</li>
            <li><strong>Détail du jet de caractéristique :</strong> Résultat de base + bonus traits + malus agilité</li>
            <li>Résultat du jet de qualité</li>
            <li>Bonus de l'arme (si > 0)</li>
            <li><strong>Résultat total détaillé</strong> avec tous les composants</li>
        </ul>
    </div>

    <div class="feature">
        <h2>🧪 Exemple d'Utilisation</h2>
        <p><strong>Scénario :</strong> Arme de type "Force" avec Martialité 4d4, Qualité 1d8, Bonus +2</p>
        
        <h3>Mode Safe :</h3>
        <p><code>Formule : 4d4 + bonus traits + malus agilité + 1d8 + 2</code></p>
        <p>Pas de coups critiques possibles</p>
        
        <h3>Mode Unsafe :</h3>
        <p><code>Formule : 1d20 + bonus traits + malus agilité + 1d8 + 2</code> (4d4 transformé en 1d20)</p>
        <p><strong>Réussite critique :</strong> Si les 1d20 donnent 20 (maximum)</p>
        <p><strong>Échec critique :</strong> Si les 1d20 donnent 1 (minimum)</p>
        <p><strong>Exemple concret :</strong> Si Martialité 4d4 avec +3 bonus trait et -1 malus agilité :</p>
        <p>Safe : 4d4 + 3 - 1 + 1d8 + 2</p>
        <p>Unsafe : 1d20 + 3 - 1 + 1d8 + 2</p>
    </div>

    <div class="success">
        <h2>🎉 Système Complet !</h2>
        <p>Le système d'attaque d'armes est maintenant <strong>PARFAITEMENT</strong> fonctionnel avec :</p>
        <ul>
            <li>✅ Modes Safe et Unsafe avec transformation des dés</li>
            <li>✅ Détection des coups critiques basée sur les dés transformés</li>
            <li>✅ <strong>INTÉGRATION COMPLÈTE des bonus de traits et malus d'agilité</strong></li>
            <li>✅ Interface utilisateur intuitive</li>
            <li>✅ Gestion des boucliers</li>
            <li>✅ Messages de chat ultra-détaillés avec décomposition complète</li>
            <li>✅ Formules d'attaque parfaitement cohérentes avec le système de jeu</li>
        </ul>
        <p><strong>🎉 LE COOKIE EST MÉRITÉ ! 🍪</strong></p>
        <p><strong>🎯 TOUS les systèmes sont maintenant parfaitement intégrés et cohérents !</strong></p>
    </div>

    <div class="info">
        <h2>📋 Fichiers Modifiés</h2>
        <ul>
            <li><code>templates/sheets/heros-sheet.html</code> - Boutons Safe/Unsafe et correction des rangs</li>
            <li><code>styles/heros-sheet.css</code> - Styles pour les nouveaux boutons</li>
            <li><code>scripts/heros-sheet.js</code> - Logique d'attaque avec modes et coups critiques</li>
        </ul>
    </div>
</body>
</html>
