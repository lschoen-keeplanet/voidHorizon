<form class="{{#if isReadOnly}}read-only{{/if}} voidHorizon-sheet heros-sheet" autocomplete="off">
    <header class="sheet-header">
        <div class="header-main">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
            <div class="header-fields">
                <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Nom" /></h1>
                <div class="header-details">
                    <div class="header-row">
                        <div class="faction-line">
                            <label>Faction:</label>
                            <select name="system.faction.value">
                                <option value="caradoc" {{selected "caradoc" system.faction.value}}>Compagnie Caradoc
                                </option>
                                <option value="sauvignon" {{selected "sauvignon" system.faction.value}}>Sauvignon
                                </option>
                                <option value="banniere-rouge" {{selected "banniere-rouge" system.faction.value}}>
                                    Bannière rouge</option>
                                <option value="banniere-verte" {{selected "banniere-verte" system.faction.value}}>
                                    Bannière verte</option>
                            </select>
                        </div>
                        <div class="rank-line">
                            <label>Rang & titre:</label>
                            <input type="text" name="system.rank.value" value="{{system.rank.value}}"
                                placeholder="Rang dans la compagnie" />
                        </div>
                    </div>
                    <div class="header-row">
                        <div class="class-line">
                            <label>Classe:</label>
                            <select name="system.class.value">
                                <option value="panzer" {{selected "panzer" system.class.value}}>Panzer</option>
                                <option value="tirailleur" {{selected "tirailleur" system.class.value}}>Tirailleur
                                </option>
                                <option value="soigneur" {{selected "soigneur" system.class.value}}>Soigneur</option>
                                <option value="mage" {{selected "mage" system.class.value}}>Mage</option>
                            </select>
                        </div>
                        <div class="affinity-line">
                            <label>Affinité:</label>
                            <select name="system.affinity.value">
                                <option value="aucune" {{selected "aucune" system.affinity.value}}>Aucune</option>
                                <option value="aeris" {{selected "aeris" system.affinity.value}}>Aeris</option>
                                <option value="aqua" {{selected "aqua" system.affinity.value}}>Aqua</option>
                                <option value="magicka" {{selected "magicka" system.affinity.value}}>Magicka</option>
                                <option value="ignis" {{selected "ignis" system.affinity.value}}>Ignis</option>
                                <option value="terra" {{selected "terra" system.affinity.value}}>Terra</option>
                                <option value="exterieur" {{selected "exterieur" system.affinity.value}}>Extérieur
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="faction-crest">
                <img src="systems/voidHorizon/assets/crests/{{system.faction.value}}.png"
                    alt="Blason {{system.faction.value}}" />
            </div>
        </div>
        <div class="main-content">
            <div class="stats-health-row">
                <div class="main">
                    <div class="stats-grid">
                        <div class="stat-block">
                            <div class="stat-header">
                                <img src="systems/voidHorizon/assets/icons/martialite.png" class="stat-icon" alt="Martialité">
                                <label class="rollable" data-stat="martialite">Martialité</label>
                            </div>
                            <div class="stat-controls">
                                <select name="system.martialite.value" class="edit-mode">
                                    {{#select system.martialite.value}}
                                                                         <option value="1d4">Incompétent</option>
                                    <option value="1d6">Combatif</option>
                                    <option value="1d8">Soldat</option>
                                    <option value="1d10">Expérimenté</option>
                                    <option value="1d12">Vétéran</option>
                                    <option value="1d20">Légende</option>
                                    {{/select}}
                                </select>
                                <div class="read-mode">{{helpers.getSelectedText actor.system.martialite.value "martialite"}}</div>
                            </div>
                            <button type="button" class="roll-dice-btn" data-stat="martialite" title="Lancer les dés de Martialité">
                                <i class="fas fa-dice-d20"></i>
                            </button>
                        </div>
                        
                        <div class="stat-block">
                            <div class="stat-header">
                                <img src="systems/voidHorizon/assets/icons/pimpance.png" class="stat-icon" alt="Pimpance">
                                <label class="rollable" data-stat="pimpance">Pimpance</label>
                            </div>
                            <div class="stat-controls">
                                <select name="system.pimpance.value" class="edit-mode">
                                    {{#select system.pimpance.value}}
                                    <option value="1d4">Tâche</option>
                                    <option value="1d6">Pas top</option>
                                    <option value="1d8">Honnête</option>
                                    <option value="1d10">Beau</option>
                                    <option value="1d12">Splendide</option>
                                    <option value="1d20">Ramirez</option>
                                    {{/select}}
                                </select>
                                <div class="read-mode">{{helpers.getSelectedText actor.system.pimpance.value "pimpance"}}</div>
                            </div>
                            <button type="button" class="roll-dice-btn" data-stat="pimpance" title="Lancer les dés de Pimpance">
                                <i class="fas fa-dice-d20"></i>
                            </button>
                        </div>
                        
                        <div class="stat-block">
                            <div class="stat-header">
                                <img src="systems/voidHorizon/assets/icons/acuite.png" class="stat-icon" alt="Acuité">
                                <label class="rollable" data-stat="acuite">Acuité</label>
                            </div>
                            <div class="stat-controls">
                                <select name="system.acuite.value" class="edit-mode" data-dtype="String">
                                    {{#select system.acuite.value}}
                                    <option value="1d4">Aveugle</option>
                                    <option value="1d6">Distrait</option>
                                    <option value="1d8">Alerte</option>
                                    <option value="1d10">Vif</option>
                                    <option value="1d12">Clairvoyant</option>
                                    <option value="1d20">Fulgurant</option>
                                    {{/select}}
                                </select>
                                <div class="read-mode">{{helpers.getSelectedText actor.system.acuite.value "acuite"}}</div>
                            </div>
                            <button type="button" class="roll-dice-btn" data-stat="acuite" title="Lancer les dés d'Acuité">
                                <i class="fas fa-dice-d20"></i>
                            </button>
                        </div>
                        
                        <div class="stat-block">
                            <div class="stat-header">
                                <img src="systems/voidHorizon/assets/icons/arcane.png" class="stat-icon" alt="Arcane">
                                <label class="rollable" data-stat="arcane">Arcane</label>
                            </div>
                            <div class="stat-controls">
                                <select name="system.arcane.value" class="edit-mode">
                                    {{#select system.arcane.value}}
                                    <option value="1d4">Insensible</option>
                                    <option value="1d6">Eveillé</option>
                                    <option value="1d8">Novice</option>
                                    <option value="1d10">Initié</option>
                                    <option value="1d12">Maître</option>
                                    <option value="1d20">Archimage</option>
                                    {{/select}}
                                </select>
                                <div class="read-mode">{{helpers.getSelectedText actor.system.arcane.value "arcane"}}</div>
                            </div>
                            <button type="button" class="roll-dice-btn" data-stat="arcane" title="Lancer les dés d'Arcane">
                                <i class="fas fa-dice-d20"></i>
                            </button>
                        </div>
                        <div class="edit-mode-button">
                            <button type="button" class="toggle-edit-mode" title="Cliquer pour éditer, cliquer à nouveau pour sauvegarder">
                                <i class="fas fa-edit"></i>
                                <span class="button-text">Éditer</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="health-column">
                    <div class="health-status">
                        <span class="status-label">État :</span>
                        <span class="status-value" data-health-status>
                            {{#if (gte (sub system.constitution.value system.resources.blessure.value) 3)}}
                            Bonne santé
                            {{else if (eq (sub system.constitution.value system.resources.blessure.value) 2)}}
                            Légèrement blessé
                            {{else if (eq (sub system.constitution.value system.resources.blessure.value) 1)}}
                            Grièvement blessé
                            {{else}}
                            Incapacité
                            {{/if}}
                        </span>
                    </div>

                    <div class="stats-row">
                        <div class="resource">
                            <label>Armure</label>
                            <div class="resource-value">
                                <input type="number" name="system.resources.armor.value"
                                    value="{{actor.system.resources.armor.value}}" min="0" />
                            </div>
                        </div>
                        <div class="stat">
                            <label>Constitution</label>
                            <div class="stat-controls">
                                <input type="number" name="system.constitution.value"
                                    value="{{system.constitution.value}}" min="1" max="10" />
                            </div>
                        </div>
                    </div>

                    <div class="armor-section">
                        <div class="armor-container">
                            {{#each (times actor.system.resources.armor.value)}}
                            <div class="shield-wrapper">
                                <button type="button" class="shield-button active" data-shield-index="{{this}}"
                                    data-active="true">
                                    <i class="fas fa-shield-alt"></i>
                                </button>
                                <button type="button" class="shield-button broken" data-shield-index="{{this}}"
                                    data-active="false">
                                    <i class="fas fa-shield-alt" style="opacity: 0.3;"></i>
                                </button>
                            </div>
                            {{/each}}
                        </div>
                    </div>

                    <div class="health-section">
                        <div class="hearts-container">
                            {{#each (times system.constitution.value)}}
                            <div class="heart-wrapper">
                                <button type="button" class="heart-button alive" data-heart-index="{{this}}"
                                    data-alive="true">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button type="button" class="heart-button dead" data-heart-index="{{this}}"
                                    data-alive="false">
                                    <i class="fas fa-heart-broken"></i>
                                </button>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="additional-stats">
                <!-- Espace pour les futurs éléments -->
            </div>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="secondary">
        <a class="item" data-tab="equipment">Équipement & Actions</a>
        <a class="item" data-tab="traits">Traits</a>
    </nav>

    <section class="sheet-body">
                 <!-- Équipement & Actions Tab -->
         <div class="tab equipment" data-group="secondary" data-tab="equipment">
             <!-- Section des Armes -->
             <div class="weapons-section">
                 <div class="weapons-header">
                     <h2>Armes</h2>
                 </div>
                 <div class="weapons-grid">
                                           <!-- Main Principale -->
                      <div class="weapon-slot primary-weapon">
                          <h3>Main Principale</h3>
                         <div class="weapon-form">
                             <div class="weapon-field">
                                 <label>Nom de l'arme:</label>
                                 <input type="text" name="system.weapons.primary.name" value="{{actor.system.weapons.primary.name}}" placeholder="Nom de l'arme">
                             </div>
                                                           <div class="weapon-field">
                                  <label>Type:</label>
                                  <select name="system.weapons.primary.type">
                                      <option value="strength" {{selected "strength" actor.system.weapons.primary.type}}>Force (Martialité)</option>
                                      <option value="agility" {{selected "agility" actor.system.weapons.primary.type}}>Agilité (Acuité)</option>
                                      <option value="shield" {{selected "shield" actor.system.weapons.primary.type}}>Bouclier</option>
                                  </select>
                              </div>
                             <div class="weapon-field">
                                 <label>Rang:</label>
                                 <select name="system.weapons.primary.rank">
                                     <option value="1d4" {{selected "1d4" actor.system.weapons.primary.rank}}>Arme de base (1d4)</option>
                                     <option value="1d6" {{selected "1d6" actor.system.weapons.primary.rank}}>Arme commune (1d6)</option>
                                     <option value="1d8" {{selected "1d8" actor.system.weapons.primary.rank}}>Arme de qualité (1d8)</option>
                                     <option value="1d10" {{selected "1d10" actor.system.weapons.primary.rank}}>Arme supérieure (1d10)</option>
                                     <option value="1d12" {{selected "1d12" actor.system.weapons.primary.rank}}>Arme exceptionnelle (1d12)</option>
                                     <option value="1d20" {{selected "1d20" actor.system.weapons.primary.rank}}>Arme légendaire (1d20)</option>
                                 </select>
                             </div>
                             <div class="weapon-field">
                                 <label>Bonus:</label>
                                 <input type="number" name="system.weapons.primary.bonus" value="{{actor.system.weapons.primary.bonus}}" min="-5" max="10" placeholder="0">
                             </div>
                             <div class="weapon-field">
                                 <label>Description:</label>
                                 <textarea name="system.weapons.primary.description" placeholder="Description de l'arme">{{actor.system.weapons.primary.description}}</textarea>
                             </div>
                             <button type="button" class="roll-weapon-btn" data-weapon="primary" title="Lancer les dés pour l'arme principale">
                                 <i class="fas fa-sword"></i> Lancer les dés
                             </button>
                         </div>
                     </div>
                     
                                           <!-- Main Secondaire -->
                      <div class="weapon-slot secondary-weapon">
                          <h3>Main Secondaire</h3>
                         <div class="weapon-form">
                             <div class="weapon-field">
                                 <label>Nom de l'arme:</label>
                                 <input type="text" name="system.weapons.secondary.name" value="{{actor.system.weapons.secondary.name}}" placeholder="Nom de l'arme">
                             </div>
                                                           <div class="weapon-field">
                                  <label>Type:</label>
                                  <select name="system.weapons.secondary.type">
                                      <option value="strength" {{selected "strength" actor.system.weapons.secondary.type}}>Force (Martialité)</option>
                                      <option value="agility" {{selected "agility" actor.system.weapons.secondary.type}}>Agilité (Acuité)</option>
                                      <option value="shield" {{selected "shield" actor.system.weapons.secondary.type}}>Bouclier</option>
                                  </select>
                              </div>
                             <div class="weapon-field">
                                 <label>Rang:</label>
                                 <select name="system.weapons.secondary.rank">
                                     <option value="1d4" {{selected "1d4" actor.system.weapons.secondary.rank}}>Arme de base (1d4)</option>
                                     <option value="1d6" {{selected "1d6" actor.system.weapons.secondary.rank}}>Arme commune (1d6)</option>
                                     <option value="1d8" {{selected "1d8" actor.system.weapons.secondary.rank}}>Arme de qualité (1d8)</option>
                                     <option value="1d10" {{selected "1d10" actor.system.weapons.secondary.rank}}>Arme supérieure (1d10)</option>
                                     <option value="1d12" {{selected "1d12" actor.system.weapons.secondary.rank}}>Arme exceptionnelle (1d12)</option>
                                     <option value="1d20" {{selected "1d20" actor.system.weapons.secondary.rank}}>Arme légendaire (1d20)</option>
                                 </select>
                             </div>
                             <div class="weapon-field">
                                 <label>Bonus:</label>
                                 <input type="number" name="system.weapons.secondary.bonus" value="{{actor.system.weapons.secondary.bonus}}" min="-5" max="10" placeholder="0">
                             </div>
                             <div class="weapon-field">
                                 <label>Description:</label>
                                 <textarea name="system.weapons.secondary.description" placeholder="Description de l'arme">{{actor.system.weapons.secondary.description}}</textarea>
                             </div>
                             <button type="button" class="roll-weapon-btn" data-weapon="secondary" title="Lancer les dés pour l'arme secondaire">
                                 <i class="fas fa-sword"></i> Lancer les dés
                             </button>
                         </div>
                     </div>
                 </div>
             </div>
             
             <!-- Section Équipement Général -->
             <div class="equipment-section">
                 <div class="equipment-header">
                     <h2>Équipement Général</h2>
                     <button type="button" class="create-item"><i class="fas fa-plus"></i> Ajouter un item</button>
                 </div>
                 <div class="equipment-list">
                     {{#each actor.items as |item id|}}
                     {{#if (eq item.type "equipment")}}
                     <div class="item" data-item-id="{{item._id}}">
                         <div class="item-header">
                             <div class="item-name">
                                 <h3>{{item.name}}</h3>
                             </div>
                             <div class="item-controls">
                                 <a class="item-control item-edit" title="Modifier"><i class="fas fa-edit"></i></a>
                                 <a class="item-control item-delete" title="Supprimer"><i class="fas fa-trash"></i></a>
                             </div>
                         </div>
                         <div class="item-description">
                             {{item.system.description}}
                         </div>
                     </div>
                     {{/if}}
                     {{/each}}
                 </div>
             </div>
         </div>

        <!-- Traits Tab -->
        <div class="tab traits" data-group="secondary" data-tab="traits">
            <div class="traits-section">
                <div class="traits-header">
                    <h2>Traits</h2>
                    <button type="button" class="create-trait"><i class="fas fa-plus"></i> Ajouter un trait</button>
                </div>
                <div class="traits-list">
                    {{#each actor.items as |item id|}}
                    {{#if (eq item.type "trait")}}
                    <div class="trait" data-item-id="{{item._id}}">
                        <div class="trait-header">
                            <div class="trait-name">
                                <h3>{{item.name}}</h3>
                            </div>
                            <div class="trait-controls">
                                <a class="trait-control trait-edit" title="Modifier"><i class="fas fa-edit"></i></a>
                                <a class="trait-control trait-delete" title="Supprimer"><i class="fas fa-trash"></i></a>
                            </div>
                        </div>
                        <div class="trait-description">
                            {{item.system.description}}
                        </div>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
            </div>
        </div>
    </section>
</form>