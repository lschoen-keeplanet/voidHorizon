<form class="{{#if isReadOnly}}read-only{{/if}} voidHorizon-sheet heros-sheet" autocomplete="off">
    <header class="sheet-header">
        <div class="header-main">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
            <div class="header-fields">
                <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Nom" /></h1>
                <div class="header-details">
                    <div class="header-row">
                        <div class="faction-line">
                            <label>Faction:</label>
                            <select name="system.faction.value">
                                <option value="caradoc" {{selected "caradoc" system.faction.value}}>Compagnie Caradoc
                                </option>
                                <option value="sauvignon" {{selected "sauvignon" system.faction.value}}>Sauvignon
                                </option>
                                <option value="banniere-rouge" {{selected "banniere-rouge" system.faction.value}}>
                                    Banni√®re rouge</option>
                                <option value="banniere-verte" {{selected "banniere-verte" system.faction.value}}>
                                    Banni√®re verte</option>
                            </select>
                        </div>
                        <div class="rank-line">
                            <label>Rang & titre:</label>
                            <input type="text" name="system.rank.value" value="{{system.rank.value}}"
                                placeholder="Rang dans la compagnie" />
                        </div>
                    </div>
                    <div class="header-row">
                        <div class="class-line">
                            <label>Classe:</label>
                            <select name="system.class.value">
                                <option value="panzer" {{selected "panzer" system.class.value}}>Panzer</option>
                                <option value="tirailleur" {{selected "tirailleur" system.class.value}}>Tirailleur
                                </option>
                                <option value="soigneur" {{selected "soigneur" system.class.value}}>Soigneur</option>
                                <option value="mage" {{selected "mage" system.class.value}}>Mage</option>
                            </select>
                        </div>
                        <div class="affinity-line">
                            <label>Affinit√©:</label>
                            <select name="system.affinity.value">
                                <option value="aucune" {{selected "aucune" system.affinity.value}}>Aucune</option>
                                <option value="aeris" {{selected "aeris" system.affinity.value}}>Aeris</option>
                                <option value="aqua" {{selected "aqua" system.affinity.value}}>Aqua</option>
                                <option value="magicka" {{selected "magicka" system.affinity.value}}>Magicka</option>
                                <option value="ignis" {{selected "ignis" system.affinity.value}}>Ignis</option>
                                <option value="terra" {{selected "terra" system.affinity.value}}>Terra</option>
                                <option value="exterieur" {{selected "exterieur" system.affinity.value}}>Ext√©rieur
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="faction-crest">
                <img src="systems/voidHorizon/assets/crests/{{system.faction.value}}.png"
                    alt="Blason {{system.faction.value}}" />
            </div>
        </div>
        <div class="main-content">
            <div class="stats-health-row">
                <div class="main">
                    <div class="main-fiche">
                        <div>
                            <div class="stats-grid">
                                <div class="stat-block">
                                    <div class="stat-header">
                                        <img src="systems/voidHorizon/assets/icons/martialite.png" class="stat-icon"
                                            alt="Martialit√©">
                                        <label class="rollable" data-stat="martialite">Martialit√©</label>
                                    </div>
                                    <div class="stat-controls">
                                        <select name="system.martialite.value" class="edit-mode">
                                            {{#select system.martialite.value}}
                                            <option value="1d4">Incomp√©tent</option>
                                            <option value="1d6">Combatif</option>
                                            <option value="1d8">Soldat</option>
                                            <option value="1d10">Exp√©riment√©</option>
                                            <option value="1d12">V√©t√©ran</option>
                                            <option value="1d20">L√©gende</option>
                                            {{/select}}
                                        </select>
                                        <div class="read-mode">{{helpers.getSelectedText actor.system.martialite.value
                                            "martialite"}}</div>
                                    </div>
                                    <button type="button" class="roll-dice-btn" data-stat="martialite"
                                        title="Lancer les d√©s de Martialit√©">
                                        <i class="fas fa-dice-d20"></i>
                                    </button>
                                </div>

                                <div class="stat-block">
                                    <div class="stat-header">
                                        <img src="systems/voidHorizon/assets/icons/pimpance.png" class="stat-icon"
                                            alt="Pimpance">
                                        <label class="rollable" data-stat="pimpance">Pimpance</label>
                                    </div>
                                    <div class="stat-controls">
                                        <select name="system.pimpance.value" class="edit-mode">
                                            {{#select system.pimpance.value}}
                                            <option value="1d4">T√¢che</option>
                                            <option value="1d6">Pas top</option>
                                            <option value="1d8">Honn√™te</option>
                                            <option value="1d10">Beau</option>
                                            <option value="1d12">Splendide</option>
                                            <option value="1d20">Ramirez</option>
                                            {{/select}}
                                        </select>
                                        <div class="read-mode">{{helpers.getSelectedText actor.system.pimpance.value
                                            "pimpance"}}</div>
                                    </div>
                                    <button type="button" class="roll-dice-btn" data-stat="pimpance"
                                        title="Lancer les d√©s de Pimpance">
                                        <i class="fas fa-dice-d20"></i>
                                    </button>
                                </div>

                                <div class="stat-block">
                                    <div class="stat-header">
                                        <img src="systems/voidHorizon/assets/icons/acuite.png" class="stat-icon"
                                            alt="Acuit√©">
                                        <label class="rollable" data-stat="acuite">Acuit√©</label>
                                    </div>
                                    <div class="stat-controls">
                                        <select name="system.acuite.value" class="edit-mode" data-dtype="String">
                                            {{#select system.acuite.value}}
                                            <option value="1d4">Aveugle</option>
                                            <option value="1d6">Distrait</option>
                                            <option value="1d8">Alerte</option>
                                            <option value="1d10">Vif</option>
                                            <option value="1d12">Clairvoyant</option>
                                            <option value="1d20">Fulgurant</option>
                                            {{/select}}
                                        </select>
                                        <div class="read-mode">{{helpers.getSelectedText actor.system.acuite.value
                                            "acuite"}}</div>
                                    </div>
                                    <button type="button" class="roll-dice-btn" data-stat="acuite"
                                        title="Lancer les d√©s d'Acuit√©">
                                        <i class="fas fa-dice-d20"></i>
                                    </button>
                                </div>

                                <div class="stat-block">
                                    <div class="stat-header">
                                        <img src="systems/voidHorizon/assets/icons/arcane.png" class="stat-icon"
                                            alt="Arcane">
                                        <label class="rollable" data-stat="arcane">Arcane</label>
                                    </div>
                                    <div class="stat-controls">
                                        <select name="system.arcane.value" class="edit-mode">
                                            {{#select system.arcane.value}}
                                            <option value="1d4">Insensible</option>
                                            <option value="1d6">Eveill√©</option>
                                            <option value="1d8">Novice</option>
                                            <option value="1d10">Initi√©</option>
                                            <option value="1d12">Ma√Ætre</option>
                                            <option value="1d20">Archimage</option>
                                            {{/select}}
                                        </select>
                                        <div class="read-mode">{{helpers.getSelectedText actor.system.arcane.value
                                            "arcane"}}</div>
                                    </div>
                                    <button type="button" class="roll-dice-btn" data-stat="arcane"
                                        title="Lancer les d√©s d'Arcane">
                                        <i class="fas fa-dice-d20"></i>
                                    </button>
                                </div>
                                <div class="edit-mode-button">
                                    <button type="button" class="toggle-edit-mode"
                                        title="Cliquer pour √©diter, cliquer √† nouveau pour sauvegarder">
                                        <i class="fas fa-edit"></i>
                                        <span class="button-text">√âditer</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Section des Armes et Traits -->
                            <div class="weapons-traits-section">
                                <div class="section-header">
                                    <div class="tab-buttons">
                                        <button type="button" class="tab-button active" data-tab="equipment">
                                            <h2>√âquipement</h2>
                                        </button>
                                        <button type="button" class="tab-button" data-tab="traits">
                                            <h2>Traits</h2>
                                        </button>
                                    </div>
                                </div>

                                <!-- Contenu de l'onglet √âquipement -->
                                <div class="tab-content active" data-tab="equipment">
                                    <div class="weapons-section read-only">
                                        <div class="weapons-grid">
                                            <!-- Main Principale -->
                                            <div class="weapon-slot primary-weapon">
                                                <h3>Main Principale</h3>
                                                <div class="weapon-form">
                                                    <div class="weapon-field">
                                                        <label>Nom de l'arme:</label>
                                                        <input type="text" name="system.weapons.primary.name"
                                                            value="{{actor.system.weapons.primary.name}}"
                                                            placeholder="Nom de l'arme" class="edit-mode">
                                                        <div class="read-mode">{{actor.system.weapons.primary.name}}
                                                        </div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Type:</label>
                                                        <select name="system.weapons.primary.type" class="edit-mode">
                                                            <option value="strength" {{selected "strength"
                                                                actor.system.weapons.primary.type}}>Force (Martialit√©)
                                                            </option>
                                                            <option value="agility" {{selected "agility"
                                                                actor.system.weapons.primary.type}}>Agilit√© (Acuit√©)
                                                            </option>
                                                            <option value="shield" {{selected "shield"
                                                                actor.system.weapons.primary.type}}>Bouclier</option>
                                                        </select>
                                                        <div class="read-mode">{{#if (eq
                                                            actor.system.weapons.primary.type "strength")}}Force
                                                            (Martialit√©){{else if (eq actor.system.weapons.primary.type
                                                            "agility")}}Agilit√© (Acuit√©){{else if (eq
                                                            actor.system.weapons.primary.type
                                                            "shield")}}Bouclier{{else}}Non d√©fini{{/if}}</div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Qualit√©:</label>
                                                        <select name="system.weapons.primary.rank" class="edit-mode">
                                                            <option value="0" {{selected "0"
                                                                actor.system.weapons.primary.rank}}>√âquipement bris√© (0)
                                                            </option>
                                                            <option value="1d4" {{selected "1d4"
                                                                actor.system.weapons.primary.rank}}>√âquipement commun
                                                                (1d4)</option>
                                                            <option value="1d6" {{selected "1d6"
                                                                actor.system.weapons.primary.rank}}>√âquipement de
                                                                qualit√© (1d6)</option>
                                                            <option value="1d8" {{selected "1d8"
                                                                actor.system.weapons.primary.rank}}>√âquipement rare
                                                                (1d8)</option>
                                                            <option value="1d10" {{selected "1d10"
                                                                actor.system.weapons.primary.rank}}>√âquipement
                                                                exceptionnel (1d10)</option>
                                                            <option value="1d12" {{selected "1d12"
                                                                actor.system.weapons.primary.rank}}>√âquipement
                                                                l√©gendaire (1d12)</option>
                                                            <option value="1d20" {{selected "1d20"
                                                                actor.system.weapons.primary.rank}}>√âquipement mythique
                                                                (1d20)</option>
                                                        </select>
                                                        <div class="read-mode">{{#if (eq
                                                            actor.system.weapons.primary.rank "0")}}√âquipement
                                                            bris√©{{else}}{{actor.system.weapons.primary.rank}}{{/if}}
                                                        </div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Bonus:</label>
                                                        <input type="number" name="system.weapons.primary.bonus"
                                                            value="{{actor.system.weapons.primary.bonus}}" min="-5"
                                                            max="10" placeholder="0" class="edit-mode">
                                                        <div class="read-mode">{{#if (gt
                                                            actor.system.weapons.primary.bonus
                                                            0)}}+{{/if}}{{actor.system.weapons.primary.bonus}}</div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Description:</label>
                                                        <textarea name="system.weapons.primary.description"
                                                            placeholder="Description de l'arme"
                                                            class="edit-mode">{{actor.system.weapons.primary.description}}</textarea>
                                                        <div class="read-mode">
                                                            {{actor.system.weapons.primary.description}}</div>
                                                    </div>
                                                    <button type="button" class="roll-weapon-btn read-mode"
                                                        data-weapon="primary"
                                                        title="Lancer les d√©s pour l'arme principale">
                                                        <i class="fas fa-sword"></i> Lancer les d√©s
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Main Secondaire -->
                                            <div class="weapon-slot secondary-weapon">
                                                <h3>Main Secondaire</h3>
                                                <div class="weapon-form">
                                                    <div class="weapon-field">
                                                        <label>Nom de l'arme:</label>
                                                        <input type="text" name="system.weapons.secondary.name"
                                                            value="{{actor.system.weapons.secondary.name}}"
                                                            placeholder="Nom de l'arme" class="edit-mode">
                                                        <div class="read-mode">{{actor.system.weapons.secondary.name}}
                                                        </div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Type:</label>
                                                        <select name="system.weapons.secondary.type" class="edit-mode">
                                                            <option value="strength" {{selected "strength"
                                                                actor.system.weapons.secondary.type}}>Force (Martialit√©)
                                                            </option>
                                                            <option value="agility" {{selected "agility"
                                                                actor.system.weapons.secondary.type}}>Agilit√© (Acuit√©)
                                                            </option>
                                                            <option value="shield" {{selected "shield"
                                                                actor.system.weapons.secondary.type}}>Bouclier</option>
                                                        </select>
                                                        <div class="read-mode">{{#if (eq
                                                            actor.system.weapons.secondary.type "strength")}}Force
                                                            (Martialit√©){{else if (eq
                                                            actor.system.weapons.secondary.type "agility")}}Agilit√©
                                                            (Acuit√©){{else if (eq actor.system.weapons.secondary.type
                                                            "shield")}}Bouclier{{else}}Non d√©fini{{/if}}</div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Qualit√©:</label>
                                                        <select name="system.weapons.secondary.rank" class="edit-mode">
                                                            <option value="0" {{selected "0"
                                                                actor.system.weapons.secondary.rank}}>√âquipement bris√©
                                                                (0)</option>
                                                            <option value="1d4" {{selected "1d4"
                                                                actor.system.weapons.secondary.rank}}>√âquipement commun
                                                                (1d4)</option>
                                                            <option value="1d6" {{selected "1d6"
                                                                actor.system.weapons.secondary.rank}}>√âquipement de
                                                                qualit√© (1d6)</option>
                                                            <option value="1d8" {{selected "1d8"
                                                                actor.system.weapons.secondary.rank}}>√âquipement rare
                                                                (1d8)</option>
                                                            <option value="1d10" {{selected "1d10"
                                                                actor.system.weapons.secondary.rank}}>√âquipement
                                                                exceptionnel (1d10)</option>
                                                            <option value="1d12" {{selected "1d12"
                                                                actor.system.weapons.secondary.rank}}>√âquipement
                                                                l√©gendaire (1d12)</option>
                                                            <option value="1d20" {{selected "1d20"
                                                                actor.system.weapons.secondary.rank}}>√âquipement
                                                                mythique (1d20)</option>
                                                        </select>
                                                        <div class="read-mode">{{#if (eq
                                                            actor.system.weapons.secondary.rank "0")}}√âquipement
                                                            bris√©{{else}}{{actor.system.weapons.secondary.rank}}{{/if}}
                                                        </div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Bonus:</label>
                                                        <input type="number" name="system.weapons.secondary.bonus"
                                                            value="{{actor.system.weapons.secondary.bonus}}" min="-5"
                                                            max="10" placeholder="0" class="edit-mode">
                                                        <div class="read-mode">{{#if (gt
                                                            actor.system.weapons.secondary.bonus
                                                            0)}}+{{/if}}{{actor.system.weapons.secondary.bonus}}</div>
                                                    </div>
                                                    <div class="weapon-field">
                                                        <label>Description:</label>
                                                        <textarea name="system.weapons.secondary.description"
                                                            placeholder="Description de l'arme"
                                                            class="edit-mode">{{actor.system.weapons.secondary.description}}</textarea>
                                                        <div class="read-mode">
                                                            {{actor.system.weapons.secondary.description}}</div>
                                                    </div>
                                                    <button type="button" class="roll-weapon-btn read-mode"
                                                        data-weapon="secondary"
                                                        title="Lancer les d√©s pour l'arme secondaire">
                                                        <i class="fas fa-sword"></i> Lancer les d√©s
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Bouton d'√©dition discret -->
                                    <div class="weapons-edit-mode-button" id="weapons-edit-button">
                                        <button type="button" class="toggle-weapons-edit-mode subtle-edit-btn"
                                            title="Cliquer pour √©diter, cliquer √† nouveau pour sauvegarder">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>

                                    <!-- Contenu de l'onglet Traits -->
                                    <div class="tab-content" data-tab="traits">
                                        <div class="traits-section">
                                            <div class="traits-header">
                                                <h3>Traits du personnage</h3>
                                                <button type="button" class="create-trait-btn" id="create-trait-btn">
                                                    <i class="fas fa-plus"></i> Ajouter un trait
                                                </button>
                                            </div>
                                            
                                            <!-- Message d'information -->
                                            <div class="traits-info">
                                                <p><i class="fas fa-info-circle"></i> Les traits conf√®rent des bonus aux caract√©ristiques de votre personnage. Cliquez sur "Ajouter un trait" pour commencer.</p>
                                            </div>
                                            
                                            <!-- Formulaire de cr√©ation de trait (cach√© par d√©faut) -->
                                            <div class="trait-form-container" id="trait-form-container" style="display: none;">
                                                <div class="trait-form">
                                                    <h4>Nouveau trait</h4>
                                                    <div class="trait-form-fields">
                                                        <div class="trait-field">
                                                            <label>Nom du trait:</label>
                                                            <input type="text" id="trait-name-input" placeholder="Nom du trait" />
                                                        </div>
                                                        <div class="trait-field">
                                                            <label>Description:</label>
                                                            <textarea id="trait-description-input" placeholder="Description du trait" rows="3"></textarea>
                                                        </div>
                                                        <div class="trait-field">
                                                            <label>Bonus sur:</label>
                                                            <select id="trait-bonus-target">
                                                                <option value="">S√©lectionner une caract√©ristique</option>
                                                                <option value="martialite">Martialit√©</option>
                                                                <option value="pimpance">Pimpance</option>
                                                                <option value="acuite">Acuit√©</option>
                                                                <option value="arcane">Arcane</option>
                                                                <option value="armor">Armure</option>
                                                                <option value="constitution">Constitution</option>
                                                            </select>
                                                        </div>
                                                        <div class="trait-field">
                                                            <label>Valeur du bonus:</label>
                                                            <input type="number" id="trait-bonus-value" placeholder="+1" min="-5" max="10" />
                                                        </div>
                                                    </div>
                                                    <div class="trait-form-actions">
                                                        <button type="button" class="trait-save-btn" id="trait-save-btn">
                                                            <i class="fas fa-save"></i> Sauvegarder
                                                        </button>
                                                        <button type="button" class="trait-cancel-btn" id="trait-cancel-btn">
                                                            <i class="fas fa-times"></i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Liste des traits existants -->
                                            <div class="traits-list" id="traits-list">
                                                {{#each actor.system.traits as |trait traitId|}}
                                                <div class="trait" data-trait-id="{{traitId}}">
                                                    <div class="trait-header">
                                                        <div class="trait-name">
                                                            <h4>{{trait.name}}</h4>
                                                            <span class="trait-bonus-display">
                                                                {{#if trait.bonusValue}}+{{/if}}{{trait.bonusValue}} {{trait.bonusTarget}}
                                                            </span>
                                                        </div>
                                                        <div class="trait-controls">
                                                            <button type="button" class="trait-control trait-edit" title="Modifier" data-trait-id="{{traitId}}">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button type="button" class="trait-control trait-delete" title="Supprimer" data-trait-id="{{traitId}}">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="trait-description">
                                                        {{trait.description}}
                                                    </div>
                                                </div>
                                                {{/each}}
                                                
                                                <!-- Trait de test pour v√©rifier l'affichage -->
                                                {{#unless actor.system.traits}}
                                                <div class="trait trait-test" data-trait-id="test">
                                                    <div class="trait-header">
                                                        <div class="trait-name">
                                                            <h4>üéØ Trait de Test</h4>
                                                            <span class="trait-bonus-display">
                                                                +2 Martialit√©
                                                            </span>
                                                        </div>
                                                        <div class="trait-controls">
                                                            <button type="button" class="trait-control trait-edit" title="Modifier" data-trait-id="test">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button type="button" class="trait-control trait-delete" title="Supprimer" data-trait-id="test">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="trait-description">
                                                        Ceci est un trait de test pour v√©rifier que l'onglet Traits s'affiche correctement. Vous pouvez le supprimer une fois que vous aurez cr√©√© vos propres traits.
                                                    </div>
                                                </div>
                                                {{/unless}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="health-column">
                            <div class="health-status">
                                <span class="status-label">√âtat :</span>
                                <span class="status-value" data-health-status>
                                    {{#if (gte (sub system.constitution.value system.resources.blessure.value) 3)}}
                                    Bonne sant√©
                                    {{else if (eq (sub system.constitution.value system.resources.blessure.value) 2)}}
                                    L√©g√®rement bless√©
                                    {{else if (eq (sub system.constitution.value system.resources.blessure.value) 1)}}
                                    Gri√®vement bless√©
                                    {{else}}
                                    Incapacit√©
                                    {{/if}}
                                </span>
                            </div>

                            <div class="stats-row">
                                <div class="resource">
                                    <label>Armure</label>
                                    <div class="resource-value">
                                        <input type="number" name="system.resources.armor.value"
                                            value="{{actor.system.resources.armor.value}}" min="0" />
                                    </div>
                                </div>
                                <div class="stat">
                                    <label>Constitution</label>
                                    <div class="stat-controls">
                                        <input type="number" name="system.constitution.value"
                                            value="{{system.constitution.value}}" min="1" max="10" />
                                    </div>
                                </div>
                            </div>

                            <div class="armor-section">
                                <div class="armor-container">
                                    {{#each (times actor.system.resources.armor.value)}}
                                    <div class="shield-wrapper">
                                        <button type="button" class="shield-button active" data-shield-index="{{this}}"
                                            data-active="true">
                                            <i class="fas fa-shield-alt"></i>
                                        </button>
                                        <button type="button" class="shield-button broken" data-shield-index="{{this}}"
                                            data-active="false">
                                            <i class="fas fa-shield-alt" style="opacity: 0.3;"></i>
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>

                            <div class="health-section">
                                <div class="hearts-container">
                                    {{#each (times system.constitution.value)}}
                                    <div class="heart-wrapper">
                                        <button type="button" class="heart-button alive" data-heart-index="{{this}}"
                                            data-alive="true">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                        <button type="button" class="heart-button dead" data-heart-index="{{this}}"
                                            data-alive="false">
                                            <i class="fas fa-heart-broken"></i>
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>

                        <div class="additional-stats">
                            <!-- Espace pour les futurs √©l√©ments -->
                        </div>
                    </div>
    </header>







</form>