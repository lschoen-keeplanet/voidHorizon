<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Int√©gration des Bonus dans les Ranges</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #800000;
            border-bottom: 2px solid #800000;
            padding-bottom: 10px;
        }
        .test-description {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .test-example {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
        }
        .test-result {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .test-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test - Int√©gration des Bonus dans les Ranges</h1>
    
    <div class="test-section">
        <h2 class="test-title">Objectif du Test</h2>
        <div class="test-description">
            <p><strong>Probl√®me r√©solu :</strong> Les divs "BONUS TOTAL" ont √©t√© supprim√©s de la fiche de personnage car ils n'√©taient pas tr√®s graphiques. Cependant, les bonus doivent toujours √™tre pris en compte et int√©gr√©s directement dans les ranges des d√©s.</p>
            <p><strong>Solution impl√©ment√©e :</strong> Les helpers <code>getSafeRange</code> et <code>getUnsafeRange</code> ont √©t√© modifi√©s pour calculer automatiquement le bonus total et l'appliquer aux ranges.</p>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Modifications Apport√©es</h2>
        
        <h3>1. Suppression des Divs "BONUS TOTAL"</h3>
        <div class="test-description">
            <p><strong>Fichier modifi√© :</strong> <code>templates/sheets/heros-sheet.html</code></p>
            <p>Les 5 divs suivants ont √©t√© supprim√©s :</p>
            <ul>
                <li>Bonus total pour Martialit√©</li>
                <li>Bonus total pour Agilit√©</li>
                <li>Bonus total pour Acuit√©</li>
                <li>Bonus total pour Pimpance</li>
                <li>Bonus total pour Arcane</li>
            </ul>
        </div>

        <h3>2. Mise √† Jour des Helpers de Range</h3>
        <div class="test-description">
            <p><strong>Fichier modifi√© :</strong> <code>scripts/heros-sheet.js</code></p>
            <p>Les helpers <code>getSafeRange</code> et <code>getUnsafeRange</code> ont √©t√© enrichis pour :</p>
            <ul>
                <li>Calculer automatiquement le bonus total de chaque caract√©ristique</li>
                <li>Identifier la caract√©ristique bas√©e sur la valeur des d√©s</li>
                <li>R√©cup√©rer les bonus de traits depuis <code>actor.system.traitBonuses</code></li>
                <li>Appliquer les malus d'armure pour l'agilit√©</li>
                <li>Retourner les ranges avec bonus appliqu√©s</li>
            </ul>
        </div>

        <h3>3. Mise √† Jour des Appels de Template</h3>
        <div class="test-description">
            <p><strong>Fichier modifi√© :</strong> <code>templates/sheets/heros-sheet.html</code></p>
            <p>Tous les appels aux helpers de range passent maintenant le param√®tre <code>actor</code> :</p>
            <ul>
                <li><code>{{helpers.getSafeRange system.martialite.value actor}}</code></li>
                <li><code>{{helpers.getSafeRange system.agilite.value actor}}</code></li>
                <li><code>{{helpers.getSafeRange system.acuite.value actor}}</code></li>
                <li><code>{{helpers.getSafeRange system.pimpance.value actor}}</code></li>
                <li><code>{{helpers.getSafeRange system.arcane.value actor}}</code></li>
                <li>Et de m√™me pour <code>getUnsafeRange</code></li>
            </ul>
        </div>

        <h3>4. Nettoyage CSS</h3>
        <div class="test-description">
            <p><strong>Fichier modifi√© :</strong> <code>styles/heros-sheet.css</code></p>
            <p>Les styles CSS pour <code>.bonus-display</code> ont √©t√© supprim√©s car ils ne sont plus utilis√©s.</p>
            <p><strong>Note :</strong> Les styles pour <code>.trait-bonus-display</code> ont √©t√© conserv√©s car ils sont encore utilis√©s dans la liste des traits.</p>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Fonctionnement des Ranges avec Bonus</h2>
        
        <h3>Exemple de Calcul</h3>
        <div class="test-example">
            <p><strong>Sc√©nario :</strong> Personnage avec Martialit√© 4d4 et un bonus de trait de +10</p>
            <ul>
                <li><strong>Range de base :</strong> 4d4 = 4-16</li>
                <li><strong>Bonus de trait :</strong> +10</li>
                <li><strong>Range Safe avec bonus :</strong> 14-26</li>
                <li><strong>Range Unsafe avec bonus :</strong> 11-26</li>
            </ul>
        </div>

        <h3>Gestion des Malus d'Armure</h3>
        <div class="test-example">
            <p><strong>Sc√©nario :</strong> Personnage avec Agilit√© 5d4, bonus de trait +5, et armure lourde (-8)</p>
            <ul>
                <li><strong>Range de base :</strong> 5d4 = 5-20</li>
                <li><strong>Bonus de trait :</strong> +5</li>
                <li><strong>Malus d'armure :</strong> -8</li>
                <li><strong>Bonus total :</strong> +5 + (-8) = -3</li>
                <li><strong>Range Safe avec bonus :</strong> 2-17</li>
                <li><strong>Range Unsafe avec bonus :</strong> 1-17</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Points de V√©rification</h2>
        
        <div class="test-result">
            <h3>‚úÖ √Ä V√©rifier</h3>
            <ul>
                <li><strong>Suppression des bonus totaux :</strong> V√©rifier qu'il n'y a plus de divs "Bonus total:" dans la fiche</li>
                <li><strong>Ranges avec bonus :</strong> V√©rifier que les ranges affichent les bonnes valeurs avec bonus appliqu√©s</li>
                <li><strong>Mise √† jour dynamique :</strong> V√©rifier que les ranges se mettent √† jour quand les bonus changent</li>
                <li><strong>Malus d'armure :</strong> V√©rifier que les malus d'armure sont correctement appliqu√©s aux ranges d'agilit√©</li>
                <li><strong>Bonus de traits :</strong> V√©rifier que les bonus de traits sont correctement appliqu√©s aux ranges</li>
            </ul>
        </div>

        <div class="test-warning">
            <h3>‚ö†Ô∏è Points d'Attention</h3>
            <ul>
                <li><strong>Param√®tre actor :</strong> Tous les appels aux helpers de range doivent passer le param√®tre <code>actor</code></li>
                <li><strong>Identification des caract√©ristiques :</strong> Les helpers identifient les caract√©ristiques en comparant les valeurs de d√©s</li>
                <li><strong>Gestion des erreurs :</strong> Les helpers g√®rent les cas o√π l'actor n'est pas d√©fini</li>
                <li><strong>Valeurs minimales :</strong> Les ranges ne peuvent jamais descendre en dessous de 1</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Code des Helpers Modifi√©s</h2>
        
        <h3>getSafeRange et getUnsafeRange</h3>
        <div class="test-example">
            <p>Les deux helpers suivent maintenant la m√™me logique :</p>
            <ol>
                <li>D√©terminer la range de base selon la valeur des d√©s</li>
                <li>Identifier la caract√©ristique bas√©e sur la valeur</li>
                <li>R√©cup√©rer le bonus de trait correspondant</li>
                <li>Appliquer le malus d'armure si c'est l'agilit√©</li>
                <li>Calculer le bonus total</li>
                <li>Appliquer le bonus aux ranges min et max</li>
                <li>Retourner la range ajust√©e</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">R√©sultat Attendu</h2>
        
        <div class="test-result">
            <p><strong>Avant :</strong> Les bonus totaux √©taient affich√©s s√©par√©ment et les ranges ne prenaient pas en compte les bonus</p>
            <p><strong>Apr√®s :</strong> Les bonus sont int√©gr√©s directement dans les ranges, rendant l'interface plus claire et intuitive</p>
            <p><strong>Exemple concret :</strong> Un personnage avec +10 en Martialit√© verra ses ranges passer de "4-16" √† "14-26" pour le mode Safe</p>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Instructions de Test</h2>
        
        <ol>
            <li><strong>Ouvrir la fiche de personnage</strong> et v√©rifier qu'il n'y a plus de divs "Bonus total:"</li>
            <li><strong>V√©rifier les ranges</strong> sous les boutons Safe/Unsafe pour chaque caract√©ristique</li>
            <li><strong>Ajouter des bonus de traits</strong> et v√©rifier que les ranges se mettent √† jour</li>
            <li><strong>Changer le type d'armure</strong> et v√©rifier que les ranges d'agilit√© se mettent √† jour</li>
            <li><strong>V√©rifier la coh√©rence</strong> entre les bonus affich√©s et les ranges calcul√©es</li>
        </ol>
    </div>
</body>
</html>
